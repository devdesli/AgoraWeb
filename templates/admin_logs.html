{% extends 'base.html' %}
{% block head %}
{{super()}}
<title>Admin - View Logs</title>
<style>
    .container {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        padding: 15px;
        max-height: 700px; /* Limit height for scrollability */
        overflow-y: scroll; /* Add scrollbar if content overflows */
        font-family: monospace; /* Monospace font for logs */
        font-size: 0.85em;
        white-space: pre-wrap; /* Preserve whitespace and wrap text */
        word-wrap: break-word; /* Break long words */
    }
    .log-line {
        margin-bottom: 2px;
        line-height: 1.2;
    }
    .log-filter-form {
        margin-bottom: 20px;
        background-color: #f2f2f2;
        padding: 15px;
        border-radius: 5px;
    }
    .log-filter-form label {
        margin-right: 10px;
    }
    .log-filter-form select,
    .log-filter-form input[type="text"],
    .log-filter-form input[type="number"] {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-right: 10px;
    }
    .log-filter-form button {
        padding: 8px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .log-filter-form button:hover {
        background-color: #0056b3;
    }
    .download-link {
        margin-top: 10px;
        display: inline-block;
        padding: 8px 15px;
        background-color: #28a745;
        color: white;
        text-decoration: none;
        border-radius: 4px;
    }
    .download-link:hover {
        background-color: #218838;
    }
</style>
{% endblock %}
{% block body %}
<div class="container mt-4">
    <h1>{{ log_name }}</h1>

    <div class="log-filter-form">
        <form action="{{ url_for('view_logs') }}" method="GET">
            <label for="log_type">Log Type:</label>
            <select name="log_type" id="log_type" onchange="this.form.submit()">
                {% for type in all_log_types %}
                <option value="{{ type }}" {% if log_type == type %}selected{% endif %}>
                    {{ type.replace('_', ' ').title() }}
                </option>
                {% endfor %}
            </select>

            <label for="num_lines">Last Lines:</label>
            <input type="number" name="num_lines" id="num_lines" value="{{ num_lines }}" min="1" placeholder="All">

            <label for="filter_text">Filter:</label>
            <input type="text" name="filter_text" id="filter_text" value="{{ filter_text }}" placeholder="Search text...">
            
            <button type="submit" class="btn btn-primary">Apply Filter</button>
        </form>
    </div>

    <a href="{{ url_for('download_log', log_file_name=log_type.replace('_log', '.log')) }}" class="download-link">Download Current Log File</a>

    <div class="log-container mt-3">
        {% if log_lines %}
            {% for line in log_lines %}
                <div class="log-line">{{ line | e }}</div> {# |e escapes HTML to prevent XSS #}
            {% endfor %}
        {% else %}
            <p>No log entries found for the selected type or filter.</p>
        {% endif %}
    </div>
</div>
{% endblock %}